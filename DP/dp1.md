# dp1

## [P1131 [ZJOI2007] 时态同步](https://www.luogu.com.cn/problem/P1131)（树形dp）

dp[x]为将x的子树的叶子节点全部变成最长距离的最小花费。

$dp[x]=\sum dp[y]+mxdep[x]-mxdep[y]$

## [P1800 software](https://www.luogu.com.cn/problem/P1800)(二分,dp)

未知的东西太多不好直接搞。

注意到单调性，可以二分答案，减少一个未知数。

将其中一个放到dp的一维。

显然可以这样设计$f_{i,j}$到i，弄好j个1，最多弄多少个2。
$$
f_{i,j}=\max f_{i-1,k}+b
$$
时间复杂度
$$
O(n^3 \log {n^2})
$$

## P1880 [NOI1995] 石子合并(四边形不等式优化dp)

$$
n^3 \to n^2
$$

对于区间dp
$$
dp[l][r]=\min_{l< k< r} dp[l][k]+dp[k][r] +w(l,r)
$$
设$l\le l'\le r'\le r$若：

+ $w(l',r')\le w(l,r)$

+ $w(l,r')+w(l',r) \le w(l,r)+w(l',r')$**（四边形不等式）**

**那么有**

+ 若$w(l,r)$满足上述两个个条件，那么$dp[l][r]$**满足四边形不等式**
+ 如果$dp[l][r]$满足**四边形不等式**，假设$m[l][r]$为$dp[l][r]$的最优决策点，那么$m[l][r-1]\le m[l][r]\le m[l+1][r]$

我们把$dp[l][r]=\min_{l< k< r} dp[l][k]+dp[k][r] +w(l,r)$取到最小的$k$叫做最优决策点。

结论2相当于在说，最优决策点的矩阵**每一行、每一列**都是**单调不减**的。（这非常重要，实际上这才是这个优化的核心。你甚至选择不去证明四边形不等式，而是通过打表猜出这个结论）。

```cpp
for (int i = 1; i <= n; ++i)
    m[i][i] = i; // 初始化边界决策点
for (int d = 2; d <= n; ++d)
    for (int l = 1, r = d; r <= n; ++l，++ r)
    {
        dp[l][r] = INF;
        for (int k = m[l][r - 1]; k <= m[l + 1][r]; ++k) // 利用结论，缩小了枚举范围
            if (dp[l][k] + dp[k + 1][r] + w(l, r) < dp[l][r])
            {
                dp[l][r] = dp[l][k] + dp[k + 1][r] + w(l, r); // 更新dp数组
                m[l][r] = k; // 更新决策点
            }
    }
```

如果 $f(l,r)$ 和$ g(l,r)$ 符合四边形不等式/区间包含单调性，则对于任意 $A,B≥0$ ，$ Af(l,r)+Bg(l,r)$ 也符合四边形不等式/区间包含单调性。

如果存在$f(x) $和$ g(x) $使$ w(l,r)=f(r)−g(l) $，则$ w(l,r) $符合**四边形恒等式**（即等号总是成立的四边形不等式）。如果$ f ， g $单增，则 $w $还符合区间包含单调性。

若 $h(x$) 单增且下凸， $w(l,r)$ 符合四边形不等式和区间包含单调性，则$ h(w(l,r)) $也符合四边形不等式和区间包含单调性。

若$ h(x) $下凸，$w(l,r)$ 符合四边形**恒**等式和区间包含单调性，则 $h(w(l,r))$ 也符合四边形不等式。