# 期望

## 经典题

### 例1

在一棵$n$个点的树上游走，求从根走到$x$的期望步数。

---



对每条边$(u,v)$记录从$u$走到$v$的期望步数。$S_u$表示$u$的儿子数（有根树）
$$
\begin{aligned}
E(u,v)&=\frac{1}{S_u+1}+\sum_{(u\rightarrow v')\in E,v'\neq v} (1+E(v',u)+E(u,v))\\
&=S_u+1+\sum_{(u\rightarrow v')\in E,v'\neq v} E(v',u)
\end{aligned}
$$

先向上算,在向下算.

把$v$当作$u$的父节点，那么$v'$一定是$u$的子节点。这就是一个树形 DP。算完到 root 后再从根到子节点算一下向下走的边的期望。

### 例2

构造一张 200 个点的无向图, 使得上面从$S$走到$T$的随机游走期望步数大于等于$1000000$步。

---

简单的链和完全图都不行, 考虑组合起来, 一个n=100个点得完全图 从某一个$u$点连出一条链,则$u$沿着链走一步的期望步数为
$$
E(u)=\frac{1}{n}+\frac{n-1}{n}(1+n-1+E(u))
$$
故
$$
Eu=1+n(n-1)
$$
链上有递推关系
$$
E=\frac{1}{2}+\frac{1}{2}(1+E'+E)\Rightarrow E=E'+2
$$

$$
\sum_{k=0}^{n} E_k=\frac{(E_0+E_0+2n)(n+1)}{2}=(n^2+1)(n+1)>1000000
$$

### 例3

随机一个长度为$n$个排列$p$，求$\langle p_j\rang_{j=1}^{i}$中$p_i$是最大的数的个数（即前缀最大值的个数）的期望。

---

$$
E(S)=\sum_{i=1}^{n}E(x_i)=H_n
$$

### 例4

随机一个长度为$n$个排列$p$，求$\langle p_j\rang_{j=1}^{i}$中$p_i$是最大的数的个数（即前缀最大值的个数）的平方的期望。

---

$$
E(S)=E\left( \left(\sum_{i=1}^{n}x_i \right)^2 \right)=\sum_{i\neq j} E(x_ix_j) +\sum_{i=1}^{n}E(x_i^2)
$$

由于$x_i\in\{0,1\}$ 故只用考虑前面一项

不妨认为有$i<j$ $P(i|j)=\frac{1}{i}$,故这两个事件相互独立.

因此答案为
$$
\sum_{i\neq j} \frac{1}{ij} +H_n
$$

### 例5

随机一个长度为$n$的排列$p$，求它包含$\langle w_i\rang_{i=1}^{m}$作为连续子序列的概率。

---

显然有
$$
\frac{(n-m+1)!}{n!}
$$

$$
x_j = 
\begin{cases}
1, &\text{若在位置 }j\text{ 上出现 }(w_1,\dots,w_m)\,,\\
0, &\text{否则\,.}
\end{cases}
\quad j=1,2,\dots,n-m+1\,.  
$$

$$
T=\sum_{j=1}^{n-m+1}E(x_j)=(n-m+1)\frac{1}{n(n-1)\cdots(n-m+1)}=\frac{(n-m+1)!}{n!}
$$

### 例6

有$n$堆石头，第$i$堆个数为$a_i$。每次随机选一个石头然后把那一整堆都扔了，求第1堆石头期望第几次被扔。

---

设随机变量$x_i$表示第$i$堆石头是第几个被拿走的，显然我们有
$$
x_1=1+\sum_{i=2}^{n}[x_i<x_1]
$$

$$
E(x_1)=1+\sum_{i=2}^{n} P(x_i<x_1)
$$

而

## 练习

