# 萝莉控都能学会的组合计数

## [P3807 【模板】卢卡斯定理/Lucas 定理](https://www.luogu.com.cn/problem/P3807)

### Lucass定理

对于素数$p$，有
$$
\binom{n}{k}\equiv \binom{\left\lfloor  \frac{n}{p} \right\rfloor}{\left\lfloor  \frac{k}{p} \right\rfloor} \binom{n \mod p} {k \mod p} \mod p
$$

#### 证明：

考虑利用
$$
(1+x)^n =(1+x)^{p \left\lfloor  \frac{n}{p} \right\rfloor} (1+x)^{n \mod p}
$$
注意到
$$
\binom{p}{n} =[n=0 \or p=n] \mod p
$$
那么对于
$$
\begin{aligned}
(ax^n+bx^m)^p&=\sum_{k=0}^{p} \binom{p}{k} (ax^n)^k(bx^m)^{p-k}\\
&\equiv a^px^{np}+b^px^{mp}\\
&\equiv ax^{np}+bx^{mp} \quad \text{费马小定理}
\end{aligned}
$$
于是有
$$
\begin{aligned}
(1+x)^n &=(1+x)^{p \left\lfloor  \frac{n}{p} \right\rfloor} (1+x)^{n \mod p}\\
&=(1+x^p)^{\left\lfloor  \frac{n}{p} \right\rfloor} (1+x)^{n \mod p}
\end{aligned}
$$
显然有
$$
\binom{n}{k}\equiv \binom{\left\lfloor  \frac{n}{p} \right\rfloor}{\left\lfloor  \frac{k}{p} \right\rfloor} \binom{n \mod p} {k \mod p} \mod p
$$

## [CF1545B AquaMoon and Chess](https://codeforces.com/problemset/problem/1545/B)（对应法）

因为原来的移动规则非常复杂，考虑简化移动规则。

注意到相邻两个1绑定后是可以随便移动的。

若绑定后没有单独的1，那么显然我们可以将两个1压缩，这样的方案和原始的方案是一一对应的。

若有单独的1，假设有$a$个11，b个10，c个0。我们选完a的位置后，实际上b，c的位置就完全确定了。因为b和c不能换位置。

注意末尾的单个1可以忽略不计。

> 实际上将单个1和0结合，等价于固定单个1一定在最右边。

## [P6475 [NOI Online #2 入门组] 建设城市](https://www.luogu.com.cn/problem/P6475)（dp，化简）

dp显然，直接dp不太可做。

因为m比较小，考虑枚举$x，y$处的值。然后想办法$O(1)$计算dp那部分值。

相当于在$[1,n]$不递减地填$[1,m]$中的数，求方案数量。

这实际上和有多少个数等于$i$构成的数组是一一对应的。

即
$$
x_1+\cdots +x_m =n
$$
有
$$
\binom{n+m-1}{n}
$$


> 或者你可以直接从递推柿里面看出来：(可以记住这个递推柿)
>
> 设以$f_{i,j}$是以$j$结尾，长度为$i$的单调不降序列数。有
> $$
> f_{i,j}=\sum_{k=1}^{j} f_{i-1,j}=f_{i,j-1}+f_{i-1,j}
> $$
> 
> $$
> f_{0,1}=1
> $$
> 想办法求出其通项公式。

$$
f_{i,j}=\binom{i+j-2}{i-1}
$$



## [Stack](https://ac.nowcoder.com/acm/contest/108303/C)(斯特林数)

可以直接找出递推式，然后带入推柿子做。

但我们~~注意到~~这好像是**第一类斯特林数。**

这里就简单介绍一下斯特林数。

### 第二类斯特林数

$\begin{Bmatrix} n\\ k \end{Bmatrix}$：表示将$n$个不同的球放到$k$个相同的盒子中的方案数，且不能出现空盒。

有递推式：
$$
\begin{Bmatrix} n\\ k \end{Bmatrix}=\begin{Bmatrix} n-1\\ k-1 \end{Bmatrix} +k\begin{Bmatrix} n-1\\ k \end{Bmatrix}
$$
通项公式：
$$
\begin{Bmatrix} n\\ m \end{Bmatrix}=\frac{1}{m!}\sum_{i=0}^{m-1}(-1)^i\binom{n}{i}(m-i)^n
$$
生成函数：
$$
\sum_{i\ge k} \begin{Bmatrix} i\\ k \end{Bmatrix} x^{i}=\frac{x^k}{\prod_{j=1}^{k}(1-jx)}
$$


### 第一类斯特林数

$\begin{bmatrix} n\\ k \end{bmatrix}$：表示$n$个不同的人坐$k$张圆桌的方案数。

有递推式：
$$
\begin{bmatrix} n\\ k \end{bmatrix}=(n-1)\begin{bmatrix} n-1\\ k \end{bmatrix}+\begin{bmatrix} n-1\\ k-1 \end{bmatrix}
$$

## [Perfect Journey](https://ac.nowcoder.com/acm/contest/108302/K)(树,最短路,SOSDP,FWT/FMT)

**判断树上一个点是否是另外一个点的祖先**，可以通过计算dfs，进入的时间戳和离开的时间戳。a是b的祖先，当且仅当tin[a]<=tin[b] and tout[a]>=tout[b]。

**判断树上两个点的最短路径，是否经过某些边**，定根后，找到那条边更深的点，经过这条边，当且仅当，这个点恰好是某一个点的祖先。

我们状压后，可以计算出每条路径的贡献，其并集要为全集。最少可以通过最短路解决。只从当前缺失集合的最低位 bit 所在桶扩展，保证每轮必添此位。

计数部分我们考虑容斥

设$G(x)$为选出d条边，覆盖边的集合为$x$，
$$
F(x)=\sum_{y\subseteq x} G(y)
$$
有
$$
G(x)=\sum_{y \subseteq x} (-1)^{|x|-|y|} F(y)
$$
这里的
$$
F(x)
$$
的意义是，覆盖边的集合为$x$的子集的边的$d$组合。

我们利用sosdp求出所有覆盖边的集合为$x$的边的数目，然后选出$d$条边即可。

## [Beautiful Matrix](https://ac.nowcoder.com/acm/contest/108303/D)(朱世杰恒等式)

容易想到在行上差分，题目等价于，满足一下条件的矩阵数目

+ $a_{i,j}\ge 0$
+ $a_{i,j}\ge a_{i+1,j}$
+ $\sum_{j} a_{i,j} \le m$

注意到列单减，再差分一下。

+ $b_{i,j} \ge 0$
+ $\sum_{i,j}b_{i,j} \le m$

**这相当于把$\le m$个相同的球，放入$N=\frac{n(n-1)}{2}$个不同的盒子里。**

**插板法加朱世杰恒等式：**
$$
\sum_{i=0}^{m} \binom{i+N-1}{N-1}=\binom{N+m}{m}
$$
这个小结论可以记住

把最多$m$个球放入$n$个不同的盒子里的方案为
$$
\binom{n+m}{m}
$$




