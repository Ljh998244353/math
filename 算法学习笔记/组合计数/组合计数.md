# 萝莉控都能学会的组合计数

## [P3807 【模板】卢卡斯定理/Lucas 定理](https://www.luogu.com.cn/problem/P3807)

### Lucass定理

对于素数$p$，有
$$
\binom{n}{k}\equiv \binom{\left\lfloor  \frac{n}{p} \right\rfloor}{\left\lfloor  \frac{k}{p} \right\rfloor} \binom{n \mod p} {k \mod p} \mod p
$$

#### 证明：

考虑利用
$$
(1+x)^n =(1+x)^{p \left\lfloor  \frac{n}{p} \right\rfloor} (1+x)^{n \mod p}
$$
注意到
$$
\binom{p}{n} =[n=0 \or p=n] \mod p
$$
那么对于
$$
\begin{aligned}
(ax^n+bx^m)^p&=\sum_{k=0}^{p} \binom{p}{k} (ax^n)^k(bx^m)^{p-k}\\
&\equiv a^px^{np}+b^px^{mp}\\
&\equiv ax^{np}+bx^{mp} \quad \text{费马小定理}
\end{aligned}
$$
于是有
$$
\begin{aligned}
(1+x)^n &=(1+x)^{p \left\lfloor  \frac{n}{p} \right\rfloor} (1+x)^{n \mod p}\\
&=(1+x^p)^{\left\lfloor  \frac{n}{p} \right\rfloor} (1+x)^{n \mod p}
\end{aligned}
$$
显然有
$$
\binom{n}{k}\equiv \binom{\left\lfloor  \frac{n}{p} \right\rfloor}{\left\lfloor  \frac{k}{p} \right\rfloor} \binom{n \mod p} {k \mod p} \mod p
$$

## [CF1545B AquaMoon and Chess](https://codeforces.com/problemset/problem/1545/B)（对应法）

因为原来的移动规则非常复杂，考虑简化移动规则。

注意到相邻两个1绑定后是可以随便移动的。

若绑定后没有单独的1，那么显然我们可以将两个1压缩，这样的方案和原始的方案是一一对应的。

若有单独的1，假设有$a$个11，b个10，c个0。我们选完a的位置后，实际上b，c的位置就完全确定了。因为b和c不能换位置。

注意末尾的单个1可以忽略不计。

> 实际上将单个1和0结合，等价于固定单个1一定在最右边。

## [P6475 [NOI Online #2 入门组] 建设城市](https://www.luogu.com.cn/problem/P6475)（dp，化简）

dp显然，直接dp不太可做。

因为m比较小，考虑枚举$x，y$处的值。然后想办法$O(1)$计算dp那部分值。

相当于在$[1,n]$不递减地填$[1,m]$中的数，求方案数量。

这实际上和有多少个数等于$i$构成的数组是一一对应的。

即
$$
x_1+\cdots +x_m =n
$$
有
$$
\binom{n+m-1}{n}
$$


> 或者你可以直接从递推柿里面看出来：(可以记住这个递推柿)
>
> 设以$f_{i,j}$是以$j$结尾，长度为$i$的单调不降序列数。有
> $$
> f_{i,j}=\sum_{k=1}^{j} f_{i-1,j}=f_{i,j-1}+f_{i-1,j}
> $$
> 
> $$
> f_{0,1}=1
> $$
> 想办法求出其通项公式。

$$
f_{i,j}=\binom{i+j-2}{i-1}
$$



## [Stack](https://ac.nowcoder.com/acm/contest/108303/C)(斯特林数)

可以直接找出递推式，然后带入推柿子做。

但我们~~注意到~~这好像是**第一类斯特林数。**

这里就简单介绍一下斯特林数。

### 第二类斯特林数

$\begin{Bmatrix} n\\ k \end{Bmatrix}$：表示将$n$个不同的球放到$k$个相同的盒子中的方案数，且不能出现空盒。

有递推式：
$$
\begin{Bmatrix} n\\ k \end{Bmatrix}=\begin{Bmatrix} n-1\\ k-1 \end{Bmatrix} +k\begin{Bmatrix} n-1\\ k \end{Bmatrix}
$$
通项公式：
$$
\begin{Bmatrix} n\\ m \end{Bmatrix}=\frac{1}{m!}\sum_{i=0}^{m-1}(-1)^i\binom{n}{i}(m-i)^n
$$
生成函数：
$$
\sum_{i\ge k} \begin{Bmatrix} i\\ k \end{Bmatrix} x^{i}=\frac{x^k}{\prod_{j=1}^{k}(1-jx)}
$$


### 第一类斯特林数

$\begin{bmatrix} n\\ k \end{bmatrix}$：表示$n$个不同的人坐$k$张圆桌的方案数。

有递推式：
$$
\begin{bmatrix} n\\ k \end{bmatrix}=(n-1)\begin{bmatrix} n-1\\ k \end{bmatrix}+\begin{bmatrix} n-1\\ k-1 \end{bmatrix}
$$
